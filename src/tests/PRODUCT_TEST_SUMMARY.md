# Product API 테스트 요약

#### 1. `createProduct` - 상품 등록

- ✅ 스토어 오너 권한 확인 후 상품 생성 성공
- ✅ **Prisma Transaction**을 통한 상품 정보 및 재고(`stocks`) 동시 생성 검증
- ✅ 스토어가 존재하지 않을 경우 404 에러 발생
- ✅ 입력 데이터(카테고리 명칭, 할인 정보 등) 유효성 검증

#### 2. `updateProduct` - 상품 수정

- ✅ 본인 스토어의 상품 여부 확인 후 수정 성공
- ✅ **트랜잭션 내 로직** (기존 재고 일괄 삭제 후 재생성) 호출 순서 및 인자 검증
- ✅ 스토어가 존재하지 않을 경우 404 에러 발생
- ✅ 상품이 존재하지 않을 경우 404 에러 발생
- ✅ 타인 스토어 상품 수정 시도 시 403 권한 에러 발생
- ✅ 수정 요청에 포함되지 않은 필드(price 등)는 업데이트 인자에 포함되지 않아야 함

#### 3. `deleteProduct` - 상품 삭제

- ✅ 판매자 본인 상품 삭제 성공
- ✅ 상품이 존재하지 않을 경우 404 에러 발생
- ✅ 구매자가 상품 삭제 시도 시 403 권한 에러 발생
- ✅ 타인 스토어 상품 삭제 시도 시 403 권한 에러 발생

#### 4. `createProductInquiry` - 문의 등록

- ✅ 구매자가 상품에 대한 문의 생성 성공
- ✅ 상품이 존재하지 않을 경우 404 에러 발생

#### 5. `getProductInquiries` - 상품 문의 조회

- ✅ 일반 유저 및 비로그인 유저의 비밀 문의 처리 로직 검증
- ✅ **스토어 오너(판매자)** 조회 시 모든 문의(비밀 문의 포함) 노출 여부 확인
- ✅ 존재하지 않는 상품에 대한 조회 시 404 에러 발생

#### 6. `getProductDetail` - 상품 상세 조회

- ✅ 단일 상품 상세 정보 조회 성공
- ✅ 존재하지 않는 상품 ID 조회 시 404 에러 발생

#### 7. `getProducts` - 상품 목록 조회 (필터 및 정렬)

- ✅ 기본 조건(페이징)으로 목록 조회 성공
- ✅ 검색어(`search`) 조건 적용 확인
- ✅ 가격 범위(`priceMin/Max`) 조건 적용 확인
- ✅ 카테고리(`categoryName`) 조건 적용 확인
- ✅ 다양한 정렬 조건(리뷰 많은 순 등)에 따른 **Prisma Order 객체** 생성 검증

---

## 📊 테스트 커버리지 요약

### Service 계층 커버리지: 100% (완료)

| 메서드             | 성공 케이스 | 에러/권한 케이스 | 커버리지 |
| :----------------- | :---------: | :--------------: | :------: |
| createProduct      |     ✅      |        ✅        |   100%   |
| updateProduct      |     ✅      |        ✅        |   100%   |
| deleteProduct      |     ✅      |        ✅        |   100%   |
| getProductDetail   |     ✅      |        ✅        |   100%   |
| getProducts        |     ✅      |        ✅        |   100%   |
| 문의(Inquiry) 로직 |     ✅      |        ✅        |   100%   |

### 총 테스트 케이스: 23개 (모두 통과)

---

## 🛠️ 기술적 개선 사항 (Unit Test)

- **Transaction Mocking:** `prisma.$transaction`을 모킹하여 트랜잭션 내부에서 Repository 메서드들이 올바른 순서와 인자로 호출되는지 검증했습니다.

---

## 🚀 테스트 실행 방법

### 모든 테스트 실행

```bash
npm test
```

### Product 테스트만 실행

```bash
npm test -- product
```

### 단위 테스트만 실행

```bash
npm test -- unit/product
```

### 커버리지 확인

```bash
npm run test:cov
```

### Watch 모드

```bash
npm run test:watch
```

---

### 사용 예시

```bash
# 코드 수정 후 로직 검증
npm test

# 개발 환경 초기화
npm run seed

# DB 초기화 후 재시작
npm run db:reset
```

---
